os: linux
dist: xenial
cache: pip
language: python
python:	
  - "3.6"
  - "3.7"
  - "3.8"

  
install:
  - pip install --upgrade pip setuptools wheel
  - |
    for req in ci-requirements.txt dev-requirements.txt opt-requirements.txt requirements.txt; do
      pip install -q -r $req
    done  
before_script:
  - export PYTHONPATH=$PYTHONPATH:$(pwd)
script:
  - |
    if [[ $TRAVIS_PYTHON_VERSION != 3.8 ||
          ($TRAVIS_PYTHON_VERSION == 3.8 &&
           $GEOMSTATS_BACKEND != tensorflow) ]]; then
      nose2 --with-coverage tests.tests_geomstats
    fi
env:
  - GEOMSTATS_BACKEND=numpy
  - GEOMSTATS_BACKEND=pytorch
  - GEOMSTATS_BACKEND=tensorflow

deploy:
  - provider: pypi
    username: $PYPI_USER
    password: $PYPI_PASSWORD
    on:
      repo: geomstats/geomstats
      tags: true
    distributions: "sdist bdist_wheel"
    skip_existing: true

